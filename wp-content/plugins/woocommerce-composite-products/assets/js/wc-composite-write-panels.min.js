jQuery(function(a){function b(){a(".bto_groups .bto_group").each(function(b,c){a(".group_position",c).val(parseInt(a(c).index(".bto_groups .bto_group")))})}function c(){var c=a(".bto_groups").find(".bto_group").get();c.sort(function(b,c){var d=parseInt(a(b).attr("rel")),e=parseInt(a(c).attr("rel"));return d<e?-1:d>e?1:0}),a(c).each(function(b,c){a(".bto_groups").append(c)}),a(".bto_groups").sortable({items:".bto_group",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,c){c.item.removeAttr("style"),b()}})}function d(){a(".bto_scenarios .bto_scenario").each(function(b,c){a(".scenario_position",c).val(parseInt(a(c).index(".bto_scenarios .bto_scenario")))})}function e(){var b=a(".bto_scenarios").find(".bto_scenario").get();b.sort(function(b,c){var d=parseInt(a(b).attr("rel")),e=parseInt(a(c).attr("rel"));return d<e?-1:d>e?1:0}),a(b).each(function(b,c){a(".bto_scenarios").append(c)}),a(".bto_scenarios").sortable({items:".bto_scenario",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),d()}})}var f={language:{errorLoading:function(){return wc_composite_admin_params.i18n_ajax_error},inputTooLong:function(a){var b=a.input.length-a.maximum;return 1===b?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",b)},inputTooShort:function(a){var b=a.minimum-a.input.length;return 1===b?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",b)},loadingMore:function(){return wc_composite_admin_params.i18n_load_more},maximumSelected:function(a){return 1===a.maximum?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",a.maximum)},noResults:function(){return wc_composite_admin_params.i18n_no_matches},searching:function(){return wc_composite_admin_params.i18n_searching}}},g={formatMatches:function(a){return 1===a?wc_composite_admin_params.i18n_matches_1:wc_composite_admin_params.i18n_matches_n.replace("%qty%",a)},formatNoMatches:function(){return wc_composite_admin_params.i18n_no_matches},formatAjaxError:function(a,b,c){return wc_composite_admin_params.i18n_ajax_error},formatInputTooShort:function(a,b){var c=b-a.length;return 1===c?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",c)},formatInputTooLong:function(a,b){var c=a.length-b;return 1===c?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",c)},formatSelectionTooBig:function(a){return 1===a?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",a)},formatLoadMore:function(a){return wc_composite_admin_params.i18n_load_more},formatSearching:function(){return wc_composite_admin_params.i18n_searching}};a.fn.wc_cp_select2=function(){a(document.body).trigger("wc-enhanced-select-init")},a.fn.wc_cp_select2_component_options=function(){"yes"===wc_composite_admin_params.is_wc_version_gte_2_7?a(":input.wc-component-options-search").filter(":not(.enhanced)").each(function(){var b=a(this).data("action"),c=a(this),d={allowClear:!!a(this).data("allow_clear"),placeholder:a(this).data("placeholder"),minimumInputLength:a(this).data("minimum_input_length")?a(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(c){return{term:c.term,action:b,security:wc_enhanced_select_params.search_products_nonce,exclude:a(this).data("exclude"),include:a(this).data("include"),limit:a(this).data("limit")}},processResults:function(b){var d=[];return"yes"===c.data("component_optional")&&0===c.find('option[value="-1"]').length&&d.push({id:"-1",text:wc_composite_admin_params.i18n_none}),0===c.find('option[value="0"]').length&&d.push({id:"0",text:wc_composite_admin_params.i18n_all}),b&&a.each(b,function(a,b){d.push({id:a,text:b})}),{results:d}},cache:!0}};d=a.extend(d,f),a(this).select2(d).addClass("enhanced")}):a(this).find(":input.wc-component-options-search").filter(":not(.enhanced)").each(function(){var b=a(this).data("action"),c=a(this),d={allowClear:!!a(this).data("allow_clear"),placeholder:a(this).data("placeholder"),minimumInputLength:a(this).data("minimum_input_length")?a(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(c,d){return{term:c,action:b,security:woocommerce_admin_meta_boxes.search_products_nonce,exclude:a(this).data("exclude"),include:a(this).data("include"),limit:a(this).data("limit")}},results:function(b,d){var e=[];return"yes"===c.data("component_optional")&&0===c.find('option[value="-1"]').length&&e.push({id:"-1",text:wc_composite_admin_params.i18n_none}),0===c.find('option[value="0"]').length&&e.push({id:"0",text:wc_composite_admin_params.i18n_all}),b&&a.each(b,function(a,b){e.push({id:a,text:b})}),{results:e}},cache:!0}};a(this).data("multiple")===!0?(d.multiple=!0,d.initSelection=function(b,c){var d=a.parseJSON(b.attr("data-selected")),e=[];return a(b.val().split(",")).each(function(a,b){e.push({id:b,text:d[b]})}),c(e)},d.formatSelection=function(a){return'<div class="selected-option" data-id="'+a.id+'">'+a.text+"</div>"}):(d.multiple=!1,d.initSelection=function(a,b){var c={id:a.val(),text:a.attr("data-selected")};return b(c)}),d=a.extend(d,g),a(this).select2(d).addClass("enhanced")})};var h={message:null,overlayCSS:{background:"#fff",opacity:.6}};a(".composite_stock_msg").appendTo("._manage_stock_field .description"),a("#_sold_individually").closest(".form-field").addClass("hide_if_composite"),a("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_composite"),a(".show_if_simple:not(.hide_if_composite)").addClass("show_if_composite"),"undefined"==typeof woocommerce_admin_meta_boxes&&(woocommerce_admin_meta_boxes=woocommerce_writepanel_params),a("body").on("woocommerce-product-type-change",function(b,c,d){"composite"===c&&(a(".show_if_external").hide(),a(".show_if_composite").show(),a("input#_manage_stock").change(),"no"===wc_composite_admin_params.is_wc_version_gte_2_7&&(a("#_regular_price").val(a("#_wc_cp_base_regular_price").val()).change(),a("#_sale_price").val(a("#_wc_cp_base_sale_price").val()).change()))}),a("select#product-type").change(),a("input#_downloadable").change(function(){a("select#product-type").change()}),a("#bto_product_data .bundle_group .bto_layouts").on("click",".bto_layout_label",function(){a(this).closest(".bto_layouts").find(".selected").removeClass("selected"),a(this).addClass("selected")}),a("#bto_product_data .config_group").on("click",".subsubsub a",function(){a(this).closest(".subsubsub").find("a").removeClass("current"),a(this).addClass("current"),a(this).closest(".bto_group_data").find(".tab_group").addClass("tab_group_hidden");var b=a(this).data("tab");return a(this).closest(".bto_group_data").find(".tab_group_"+b).removeClass("tab_group_hidden"),!1}).on("click","a.remove_row",function(c){var d=a(this).parent().parent();d.find("*").off(),d.remove(),b(),c.preventDefault()}).on("keyup","input.group_title",function(){a(this).closest(".bto_group").find("h3 .group_name").text(a(this).val())}).on("click",".expand_all",function(b){var c=a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox");c.removeClass("closed").addClass("open"),c.find(".bto_group_data").show(),b.preventDefault()}).on("click",".close_all",function(b){var c=a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox");c.removeClass("open").addClass("closed"),c.find(".bto_group_data").hide(),b.preventDefault()}).on("change","select.bto_query_type",function(){var b=a(this).val();a(this).closest(".bto_group").find(".bto_query_type_selector").hide(),a(this).closest(".bto_group").find(".bto_query_type_"+b).show()}).on("change",".group_priced_individually input",function(){a(this).is(":checked")?a(this).closest(".bto_group").find(".group_discount").show():a(this).closest(".bto_group").find(".group_discount").hide()}).on("change",".group_show_filters input",function(){a(this).is(":checked")?a(this).closest(".bto_group").find(".group_filters").show():a(this).closest(".bto_group").find(".group_filters").hide()}),a("#bto_product_data .config_group select.bto_query_type").change(),a("#bto_product_data .config_group .group_priced_individually input").change(),a("#bto_product_data .config_group .group_show_filters input").change(),a("#bto_product_data .config_group, #bto_scenario_data .bto_scenarios").wc_cp_select2_component_options();var i=a(".bto_groups .bto_group").length;a("#bto_product_data").on("click","button.add_bto_group",function(){a("#bto_product_data").block(h),i++;var b={action:"woocommerce_add_composite_component",post_id:woocommerce_admin_meta_boxes.post_id,id:i,security:wc_composite_admin_params.add_component_nonce};return a.post(woocommerce_admin_meta_boxes.ajax_url,b,function(b){a("#bto_config_group_inner .bto_groups").append(b);var c=a("#bto_config_group_inner .bto_groups .bto_group").last();c.wc_cp_select2(),c.find("select.bto_query_type").change(),c.find(".group_show_filters input").change(),c.find(".group_priced_individually input").change(),c.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),a("#bto_product_data").unblock(),c.trigger("woocommerce_bto_component_added")}),!1});var j={image_frame:!1,$button:!1};a("#bto_product_data").on("click",".upload_component_image_button",function(b){return j.$button=a(this),b.preventDefault(),j.image_frame?void j.image_frame.open():(j.image_frame=wp.media({title:wc_composite_admin_params.i18n_choose_component_image,button:{text:wc_composite_admin_params.i18n_set_component_image},states:[new wp.media.controller.Library({title:wc_composite_admin_params.i18n_choose_component_image,filterable:"all"})]}),j.image_frame.on("select",function(){var a=j.image_frame.state().get("selection").first().toJSON(),b=a.sizes&&a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;j.$button.addClass("has_image"),j.$button.closest(".component_image").find(".remove_component_image_button").addClass("has_image"),j.$button.find("input").val(a.id).change(),j.$button.find("img").eq(0).attr("src",b)}),void j.image_frame.open())}),a("#bto_product_data").on("click",".remove_component_image_button",function(b){var c=a(this),d=c.closest(".component_image"),e=d.find(".upload_component_image_button");b.preventDefault(),e.removeClass("has_image"),c.removeClass("has_image"),d.find("input").val("").change(),e.find("img").eq(0).attr("src",wc_composite_admin_params.wc_placeholder_img_src)}),a("#bto_scenario_data #bto_scenarios_inner").on("click","a.remove_row",function(b){var c=a(this).parent().parent();c.find("*").off(),c.remove(),d(),b.preventDefault()}).on("keyup","input.scenario_title",function(){a(this).closest(".bto_scenario").find("h3 .scenario_name").text(a(this).val())}).on("click",".expand_all",function(b){var c=a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox");c.removeClass("closed").addClass("open"),c.find(".bto_scenario_data").show(),b.preventDefault()}).on("click",".close_all",function(b){var c=a(this).closest(".wc-metaboxes-wrapper").find(".wc-metabox");c.removeClass("open").addClass("closed"),c.find(".bto_scenario_data").hide(),b.preventDefault()}),a("#bto_scenario_data #bto_scenarios_inner").on("change","select.bto_scenario_exclude",function(){"masked"===a(this).val()?a(this).closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideUp(200):a(this).closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideDown(200)});var k=a(".bto_scenarios .bto_scenario").length;a("#bto_scenario_data").on("click","button.add_bto_scenario",function(){a("#bto_scenario_data").block(h),k++;var b={action:"woocommerce_add_composite_scenario",post_id:woocommerce_admin_meta_boxes.post_id,id:k,security:wc_composite_admin_params.add_scenario_nonce};return a.post(woocommerce_admin_meta_boxes.ajax_url,b,function(b){a("#bto_scenarios_inner .bto_scenarios").append(b);var c=a(".bto_scenario_"+k);c.wc_cp_select2(),c.wc_cp_select2_component_options(),c.find(".tips, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),a("#bto_scenario_data").unblock(),c.trigger("woocommerce_bto_scenario_added")}),!1}),a("#bto_scenario_data #bto_scenarios_inner").on("change",".toggle_conditional_components input",function(){a(this).is(":checked")?a(this).closest(".scenario_action_conditional_components_group").find(".action_components").slideDown(200):a(this).closest(".scenario_action_conditional_components_group").find(".action_components").slideUp(200)}),c(),e(),a(".save_composition").on("click",function(){a("#bto_product_data, #bto_scenario_data").block(h),a(".bto_groups .bto_group").find("*").off();var b={post_id:woocommerce_admin_meta_boxes.post_id,data:a("#bto_product_data, #bto_scenario_data").find("input, select, textarea").serialize(),action:"woocommerce_bto_composite_save",security:wc_composite_admin_params.save_composite_nonce};a.post(woocommerce_admin_meta_boxes.ajax_url,b,function(b){var d=window.location.toString();d=d.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&"),a.get(d,function(d){var f=[],g=[],h=a("#bto_product_data #bto_config_group_inner"),i=a("#bto_scenario_data #bto_scenarios_inner"),j=a(d).find("#bto_config_group_inner"),k=a(d).find("#bto_scenarios_inner");h.find(".bto_group").each(function(){var b=a(this);if(b.hasClass("open")){var c=b.find("h3 .group_name").text();c&&f.push(c)}}),j.find(".bto_group").each(function(){var b=a(this),c=b.find("h3 .group_name").text();a.inArray(c,f)!==-1?(b.addClass("open").removeClass("closed"),b.find(".wc-metabox-content").show()):b.find(".wc-metabox-content").hide()}),i.find(".bto_scenario").each(function(){var b=a(this);if(b.hasClass("open")){var c=b.find("h3 .scenario_name").text();c&&g.push(c)}}),k.find(".bto_scenario").each(function(){var b=a(this),c=b.find("h3 .scenario_name").text();a.inArray(c,g)!==-1?(b.addClass("open").removeClass("closed"),b.find(".wc-metabox-content").show()):b.find(".wc-metabox-content").hide()}),h.html(j.html()),i.html(k.html()),c(),e(),a("#bto_product_data .woocommerce-help-tip, #bto_scenario_data .woocommerce-help-tip, #bto_scenario_data .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),h.find("select.bto_query_type").change(),h.find(".group_priced_individually input").change(),h.find(".group_show_filters input").change(),h.wc_cp_select2(),i.wc_cp_select2(),h.wc_cp_select2_component_options(),i.wc_cp_select2_component_options(),b.length>0&&a.each(b,function(a,b){window.alert(b)}),a("#bto_product_data, #bto_scenario_data").unblock()})},"json")})});